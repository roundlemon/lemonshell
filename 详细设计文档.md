# 详细设计文档

## 关键变量

| 变量名                 | 变量值                                                 | 意义                               |
| ---------------------- | ------------------------------------------------------ | ---------------------------------- |
| MAXLINE                | 4096                                                   | 命令行最大长度                     |
| MAXWORD                | 10                                                     | 命令行最大“单词”数                 |
| default_prompt         | "->"                                                   | 如果没有PROMPT环境变量的默认提示符 |
| Env                    | "PROMPT"                                               | 当作提示符的环境变量               |
| RWRWRW                 | (S_IRUSR\|S_IWUSR\|S_IRGRP\|S_IWGRP\|S_IROTH\|S_IWOTH) | 重定向输出文件权限                 |
| char prompt[10]        | null                                                   | 存放用户输入的提示符               |
| char buf[MAXLINE]      | null                                                   | 存放用户输入的命令                 |
| char *command[MAXWORD] | null                                                   | 分解用户输入的命令成为一个个“单词” |
| int reinput_flag       | 0                                                      | 输入重定向标志                     |
| int reoutput_flag      | 0                                                      | 输出重定向标志                     |
| int bg_flag            | 0                                                      | 后台运行标志                       |

## 关键函数设计

| 函数名                                                       | 函数意义                             |
| ------------------------------------------------------------ | ------------------------------------ |
| void SetEnv(void)                                            | 设置提示符                           |
| void Sig_int(int sigo)                                       | 遇到ctrl+c信号正常退出               |
| void Split_string(char *buf, char *command[10], int *reinput, int *reoutput) | 分割命令行并检查是否有输入输出重定向 |
| int main(void)                                               | 主函数                               |

## 函数运行流程

​		  main

​		  	|------SetEnv

↑-------->|------输入命令

↑			|------Split_string

|			↓--------------------------fork

|				|父				    |子

|			    |					    |------reinput_flag=1？

|			    |						|N         	   |Y

|			    |						|				   |------输入重定向

|			    |						|				   |

|			    |						↓———— > |-----reoutput_flag=1?

|			    |													|N         	   |Y

|			    |													|				   |------输出重定向

|			    |													|				   |

|	 		   |													↓———— >|-----bg_flag=1?

| 		 	  |																				|N			|Y

|				↓																				|			   |-----后台运行

↑<-----------\|<------------------Wait------------------<-------------------↓			   |

↑<----------------------------------------------<--------------------------------------------↓				

